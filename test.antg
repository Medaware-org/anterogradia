@library "org.medaware.anterogradia.libs.LinearAlgebra" as la

progn{progn{_fun(expr=progn{la.validate(str=__validator_value())},id="TraBYKTyGCKcVazddnpPgyjsNsnGOBfGvRLdpKDQlpePkMMmdTDHyWNVEjLmIThphRnyEKCwHfwVcNOdynErBSDIPLnwLQHikthPpnQawyuJUUAKHYKSlksPqmPYVIFe"),__register_validator(type="vector",validator="TraBYKTyGCKcVazddnpPgyjsNsnGOBfGvRLdpKDQlpePkMMmdTDHyWNVEjLmIThphRnyEKCwHfwVcNOdynErBSDIPLnwLQHikthPpnQawyuJUUAKHYKSlksPqmPYVIFe")},_fun(expr=progn{sequence{__require_prop(err="The property 'a' required for function 'quadratic_solve' was not present at the time of evaluation.",id="a"),__validate(type="real",value=get(key="a"))},sequence{__require_prop(err="The property 'b' required for function 'quadratic_solve' was not present at the time of evaluation.",id="b"),__validate(type="real",value=get(key="b"))},sequence{__require_prop(err="The property 'c' required for function 'quadratic_solve' was not present at the time of evaluation.",id="c"),__validate(type="real",value=get(key="c"))},progn{set(value=signflp(expr=get(key="b")),key="neg_b"),set(value=sub(left=pow(pow="2",expr=get(key="b")),right=mul(left="4",right=mul(left=get(key="a"),right=get(key="c")))),key="det"),set(value=mul(left="2",right=get(key="a")),key="denominator"),_if(then=progn{la.v{div(left=add(left=get(key="neg_b"),right=sqrt(expr=get(key="det"))),right=get(key="denominator"))}},cond=equal(left=get(key="det"),right="0"),else=progn{_if(then=progn{la.v{div(left=add(left=get(key="neg_b"),right=sqrt(expr=get(key="det"))),right=get(key="denominator")),div(left=sub(left=get(key="neg_b"),right=sqrt(expr=get(key="det"))),right=get(key="denominator"))}},cond=lgt(left=get(key="det"),right="0"),else=progn{"none"})})}},id="quadratic_solve"),_fun(expr=progn{sequence{__require_prop(err="The property 'sphere_c' required for function 'ray_v_sphere' was not present at the time of evaluation.",id="sphere_c"),__validate(type="vector",value=get(key="sphere_c"))},sequence{__require_prop(err="The property 'sphere_r' required for function 'ray_v_sphere' was not present at the time of evaluation.",id="sphere_r"),__validate(type="real",value=get(key="sphere_r"))},sequence{__require_prop(err="The property 'ray_origin' required for function 'ray_v_sphere' was not present at the time of evaluation.",id="ray_origin"),__validate(type="vector",value=get(key="ray_origin"))},sequence{__require_prop(err="The property 'ray_direction' required for function 'ray_v_sphere' was not present at the time of evaluation.",id="ray_direction"),__validate(type="vector",value=get(key="ray_direction"))},progn{set(value=la.sub{get(key="ray_origin"),get(key="sphere_c")},key="P"),set(value=la.dot(a=get(key="ray_direction"),b=get(key="ray_direction")),key="a"),set(value=mul(left="2.0",right=la.dot(a=get(key="P"),b=get(key="ray_direction"))),key="b"),set(value=la.dot(a=get(key="P"),b=get(key="P")),key="c"),set(value=callw(expr=_eval(id="quadratic_solve"),after=progn{set(value=get(key="zEKNaOLKqMwImgInbZetFxdvhrioNxUiiKtCcTwndjDBHAcgKgdaaSJdgUReSGRnCPsyZiCJRgoZjbaKHoSXgJwnoUquNVHcTUSJynojpFfKIvrDCNkSaRSFChXrlaOo"),key="a"),set(value=get(key="vpsWbsjgiDPoUrwVyqFGLvXlRrzXuVcygPQZgtHJVaSLxonXGbKrBZabESQvIOWQIGzLthmSCdHJrRgSXhsRqZYTKNVdoOvSkYvqfutSaqYxVuXyZWcIxOdiGoMKxtiV"),key="b"),set(value=get(key="UJdpofILKCxDAlKrgQytxeswBvreRIDUuDBFllvLJScmcrsiMrqsayOZRiBWiScyYqkCTeBVDTPUCuPTveqLGSYcXKQMYBgrvnzYAHsawAbCSBHsGpTrBVWnJQdcwplz"),key="c")},before=progn{set(value=get(key="a"),key="zEKNaOLKqMwImgInbZetFxdvhrioNxUiiKtCcTwndjDBHAcgKgdaaSJdgUReSGRnCPsyZiCJRgoZjbaKHoSXgJwnoUquNVHcTUSJynojpFfKIvrDCNkSaRSFChXrlaOo"),set(value=get(key="a"),key="a"),set(value=get(key="b"),key="vpsWbsjgiDPoUrwVyqFGLvXlRrzXuVcygPQZgtHJVaSLxonXGbKrBZabESQvIOWQIGzLthmSCdHJrRgSXhsRqZYTKNVdoOvSkYvqfutSaqYxVuXyZWcIxOdiGoMKxtiV"),set(value=get(key="b"),key="b"),set(value=get(key="c"),key="UJdpofILKCxDAlKrgQytxeswBvreRIDUuDBFllvLJScmcrsiMrqsayOZRiBWiScyYqkCTeBVDTPUCuPTveqLGSYcXKQMYBgrvnzYAHsawAbCSBHsGpTrBVWnJQdcwplz"),set(value=get(key="c"),key="c")}),key="solutions"),_if(then=progn{signflp(expr="1.0")},cond=equal(left=get(key="solutions"),right="none"),else=progn{set(value=la.dims(v=get(key="solutions")),key="dimCount"),_if(then=progn{signflp(expr="1.0")},cond=equal(left=get(key="dimCount"),right="0"),else=progn{_if(then=progn{la.x(v=get(key="solutions"))},cond=equal(left=get(key="dimCount"),right="1"),else=progn{set(value=la.x(v=get(key="solutions")),key="_first"),set(value=la.y(v=get(key="solutions")),key="_second"),_if(then=progn{get(key="_second")},cond=rgt(left=get(key="_first"),right="0"),else=progn{_if(then=progn{get(key="_first")},cond=rgt(left=get(key="_second"),right="0"),else=progn{la.min(v=get(key="solutions"))})})})})})}},id="ray_v_sphere"),_fun(expr=progn{sequence{__require_prop(err="The property 'width' required for function 'ray_direction' was not present at the time of evaluation.",id="width"),__validate(type="integer",value=get(key="width"))},sequence{__require_prop(err="The property 'height' required for function 'ray_direction' was not present at the time of evaluation.",id="height"),__validate(type="integer",value=get(key="height"))},sequence{__require_prop(err="The property 'x' required for function 'ray_direction' was not present at the time of evaluation.",id="x"),__validate(type="integer",value=get(key="x"))},sequence{__require_prop(err="The property 'y' required for function 'ray_direction' was not present at the time of evaluation.",id="y"),__validate(type="integer",value=get(key="y"))},progn{set(value=la.v{add(left=mul(left=signflp(expr="1"),right=div(left=get(key="width"),right="2")),right=get(key="x")),add(left=mul(left=signflp(expr="1"),right=div(left=get(key="height"),right="2")),right=get(key="y")),"1.0"},key="planePosition"),set(value=la.v{"0","0","0"},key="cameraOrigin"),la.normalize(v=la.sub{get(key="planePosition"),get(key="cameraOrigin")})}},id="ray_direction"),_fun(expr=progn{sequence{__require_prop(err="The property 'width' required for function 'render_pixel' was not present at the time of evaluation.",id="width"),__validate(type="integer",value=get(key="width"))},sequence{__require_prop(err="The property 'height' required for function 'render_pixel' was not present at the time of evaluation.",id="height"),__validate(type="integer",value=get(key="height"))},sequence{__require_prop(err="The property 'x' required for function 'render_pixel' was not present at the time of evaluation.",id="x"),__validate(type="integer",value=get(key="x"))},sequence{__require_prop(err="The property 'y' required for function 'render_pixel' was not present at the time of evaluation.",id="y"),__validate(type="integer",value=get(key="y"))},progn{set(value=la.v{"0","0","0"},key="cameraOrigin"),set(value=callw(expr=_eval(id="ray_direction"),after=progn{set(value=get(key="OyaCHMVgmOvLCDtHSzySJFomJiYWiGfYyKVFhPvnNvwHLmeWBSHdDhNPYytcjKPhPUfnHcTWRPfdviZwbDSrObAOfejXbDbsUABYReuLgWOPCyvxRlGfuSqpKEEaaeuW"),key="width"),set(value=get(key="SkZqNkzXdJhGSVkTNCuUodsuVCjZCTCaTHXpWmHWxtQVQReGimOCzkmrXIWHOywIaWuJPnFTOWKbmPGOdfQjPydADdrpqNKgyTIcgaYeaAsydMhQvdBxqrNTXcrjjzta"),key="x"),set(value=get(key="runczBQlqwUULGktFoLARwUaiMqpxhWmJzHXtGsTfyTyCgeZUDawlyVYiwXCoDFuLTZpVAPGcMPjBBzeNBqCDmCOisujKVmiUANUeKLyNidqLKFQJSQwliRuZAtbdfXT"),key="y"),set(value=get(key="HkxNQVgboMuARiZxcKUQzfcLhZHDaoMVqWpbLDpQrEoojuoBoeEtqeezJSqQiFisxhJiAQTvCIdzkbGuivdEHxyOUBZLUkvpjBSnMEColwREWsEdfsETBUohDuawNubp"),key="height")},before=progn{set(value=get(key="width"),key="OyaCHMVgmOvLCDtHSzySJFomJiYWiGfYyKVFhPvnNvwHLmeWBSHdDhNPYytcjKPhPUfnHcTWRPfdviZwbDSrObAOfejXbDbsUABYReuLgWOPCyvxRlGfuSqpKEEaaeuW"),set(value=get(key="width"),key="width"),set(value=get(key="x"),key="SkZqNkzXdJhGSVkTNCuUodsuVCjZCTCaTHXpWmHWxtQVQReGimOCzkmrXIWHOywIaWuJPnFTOWKbmPGOdfQjPydADdrpqNKgyTIcgaYeaAsydMhQvdBxqrNTXcrjjzta"),set(value=get(key="x"),key="x"),set(value=get(key="y"),key="runczBQlqwUULGktFoLARwUaiMqpxhWmJzHXtGsTfyTyCgeZUDawlyVYiwXCoDFuLTZpVAPGcMPjBBzeNBqCDmCOisujKVmiUANUeKLyNidqLKFQJSQwliRuZAtbdfXT"),set(value=get(key="y"),key="y"),set(value=get(key="height"),key="HkxNQVgboMuARiZxcKUQzfcLhZHDaoMVqWpbLDpQrEoojuoBoeEtqeezJSqQiFisxhJiAQTvCIdzkbGuivdEHxyOUBZLUkvpjBSnMEColwREWsEdfsETBUohDuawNubp"),set(value=get(key="height"),key="height")}),key="direction"),set(value=callw(expr=_eval(id="ray_v_sphere"),after=progn{set(value=get(key="lysZmnfoXHShkXpTceeSpZGEUJItIQbAvUhMUtwmPWJALylKnwXkwETAQeCJvNLCGRNYWDrqiKouQqLFjDNZAsDoZCktakrVMZipMnPBEeeWSGPOPpzzGsZUQbIDDxoo"),key="ray_direction"),set(value=get(key="tVkETviolNMxEXuEKLlceAYROUVXeqyMMztOnjMUTFvmXIbjjpUSliKHkDgyIFpDCzirUawcfALujTJGcQSFAopgZTbgXEsHzvYWZNdvxXmYxMbCxZQdeatDnqhVIvFS"),key="ray_origin"),set(value=get(key="lRUPpUbOkZtNtkIPVVAoaWqtBPyvrEqLQSwfyULnDnSJBfDxQeFyrAqoDJQHaqDdGfOtqnGIYNYztilRxBUijYvFoEYPEGxPWpsAAPTQHilVzRNqOQPCkXDmsdrgJSUm"),key="sphere_c"),set(value=get(key="XuUEuMjyeDAbEjUyzWWagQVxTzPQaMqTnSYLdyNGUZmGPYdTaPqssTNollVSqyAFTyRxSlcbhDOapauCSbxGqLnojaBuPecrMuagzFtIykgVWOzcATeXoCSLWippTyCL"),key="sphere_r")},before=progn{set(value=get(key="ray_direction"),key="lysZmnfoXHShkXpTceeSpZGEUJItIQbAvUhMUtwmPWJALylKnwXkwETAQeCJvNLCGRNYWDrqiKouQqLFjDNZAsDoZCktakrVMZipMnPBEeeWSGPOPpzzGsZUQbIDDxoo"),set(value=get(key="direction"),key="ray_direction"),set(value=get(key="ray_origin"),key="tVkETviolNMxEXuEKLlceAYROUVXeqyMMztOnjMUTFvmXIbjjpUSliKHkDgyIFpDCzirUawcfALujTJGcQSFAopgZTbgXEsHzvYWZNdvxXmYxMbCxZQdeatDnqhVIvFS"),set(value=get(key="cameraOrigin"),key="ray_origin"),set(value=get(key="sphere_c"),key="lRUPpUbOkZtNtkIPVVAoaWqtBPyvrEqLQSwfyULnDnSJBfDxQeFyrAqoDJQHaqDdGfOtqnGIYNYztilRxBUijYvFoEYPEGxPWpsAAPTQHilVzRNqOQPCkXDmsdrgJSUm"),set(value=la.v{"0","0","5"},key="sphere_c"),set(value=get(key="sphere_r"),key="XuUEuMjyeDAbEjUyzWWagQVxTzPQaMqTnSYLdyNGUZmGPYdTaPqssTNollVSqyAFTyRxSlcbhDOapauCSbxGqLnojaBuPecrMuagzFtIykgVWOzcATeXoCSLWippTyCL"),set(value="0.1",key="sphere_r")}),key="intersection"),_if(then=progn{la.v{"0","0","0"}},cond=rgt(left=get(key="intersection"),right="0"),else=progn{la.v{"255","255","255"}})}},id="render_pixel"),_fun(expr=progn{sequence{__require_prop(err="The property 'width' required for function 'ppm3_header' was not present at the time of evaluation.",id="width"),__validate(type="integer",value=get(key="width"))},sequence{__require_prop(err="The property 'height' required for function 'ppm3_header' was not present at the time of evaluation.",id="height"),__validate(type="integer",value=get(key="height"))},progn{sequence{"P3",ascii.endl(),get(key="width")," ",get(key="height"),ascii.endl(),"255",ascii.endl()}}},id="ppm3_header"),_fun(expr=progn{sequence{__require_prop(err="The property 'width' required for function 'render_all' was not present at the time of evaluation.",id="width"),__validate(type="integer",value=get(key="width"))},sequence{__require_prop(err="The property 'height' required for function 'render_all' was not present at the time of evaluation.",id="height"),__validate(type="integer",value=get(key="height"))},progn{set(value=callw(expr=_eval(id="ppm3_header"),after=progn{set(value=get(key="WwJUoXUHfKKeYnmIuhiGMeAGtcpizalkrDSwJDSnHmyXdaUtjGgsKtLMyfWhSMxVSIGrueDsbcZYWHnrTkNyRjdZkhYoQFaVRWfHhbeQXBqXUvQpffIdqXkVpvPIQlHa"),key="width"),set(value=get(key="DkZLDdTmhBhxglQuAwjXyTeBNfdScWJIbzmulOQrSOmEXicnMObGqxrEXZIlhSNjJsyilkWNqsRKHKsPWjWaImkeZoqwxgpTcKfYQnzzCzSnLAsBQIFjpdGmOUNpBnXX"),key="height")},before=progn{set(value=get(key="width"),key="WwJUoXUHfKKeYnmIuhiGMeAGtcpizalkrDSwJDSnHmyXdaUtjGgsKtLMyfWhSMxVSIGrueDsbcZYWHnrTkNyRjdZkhYoQFaVRWfHhbeQXBqXUvQpffIdqXkVpvPIQlHa"),set(value=get(key="width"),key="width"),set(value=get(key="height"),key="DkZLDdTmhBhxglQuAwjXyTeBNfdScWJIbzmulOQrSOmEXicnMObGqxrEXZIlhSNjJsyilkWNqsRKHKsPWjWaImkeZoqwxgpTcKfYQnzzCzSnLAsBQIFjpdGmOUNpBnXX"),set(value=get(key="height"),key="height")}),key="data"),set(value="0",key="x"),_while(cond=rgt(left=get(key="x"),right=get(key="width")),expr=progn{set(value="0",key="y"),_while(cond=rgt(left=get(key="y"),right=get(key="height")),expr=progn{set(value=callw(expr=_eval(id="render_pixel"),after=progn{set(value=get(key="IHtUolYnDpPVXtttgMKetuQGhEpXZiliczONBjZrRUxZpNsyVpnguJwcWiLWeAlDAokJGwSnegDSZlifYfYizAlMHfoZkjwvYvdqDsavaFuoKDpzxzVLcDNeXDrDzkoX"),key="width"),set(value=get(key="iQBjWXZoXneJKgpKigrGGqduRGiOCVPlECajShgdcUXlKKTHYIJPSBmpqCyTuEKGYNTisXXOynvYTStwnxdSPiGNhQvZJiYQxoqqNcZnQnCcVZohbtrYGwsuvIMpojaO"),key="x"),set(value=get(key="RRqHMLTNxibOMCqdkQfqFYrxxoKGTsOkEyzxzjHTwXcyiRiqfqHYcBJMwkMwEPdkMKfRkLqFGIUBwnrFiMNkfKNKLdNGKCUjHVuDUKRRFAFomFKPJNEkxHfTWjffYVWb"),key="y"),set(value=get(key="rWXquVyXhLOrWzfAePORacyXOsGNYygNNvQiZOuAgeiwXywGQVsWxAaeXMaqtrouGRmOeqiHNXwRpeqUOubcTEWWUdOOQbXVqMrLgirudAVwzpEpLiFHQjFHzfDAhbOU"),key="height")},before=progn{set(value=get(key="width"),key="IHtUolYnDpPVXtttgMKetuQGhEpXZiliczONBjZrRUxZpNsyVpnguJwcWiLWeAlDAokJGwSnegDSZlifYfYizAlMHfoZkjwvYvdqDsavaFuoKDpzxzVLcDNeXDrDzkoX"),set(value=get(key="width"),key="width"),set(value=get(key="x"),key="iQBjWXZoXneJKgpKigrGGqduRGiOCVPlECajShgdcUXlKKTHYIJPSBmpqCyTuEKGYNTisXXOynvYTStwnxdSPiGNhQvZJiYQxoqqNcZnQnCcVZohbtrYGwsuvIMpojaO"),set(value=get(key="x"),key="x"),set(value=get(key="y"),key="RRqHMLTNxibOMCqdkQfqFYrxxoKGTsOkEyzxzjHTwXcyiRiqfqHYcBJMwkMwEPdkMKfRkLqFGIUBwnrFiMNkfKNKLdNGKCUjHVuDUKRRFAFomFKPJNEkxHfTWjffYVWb"),set(value=get(key="y"),key="y"),set(value=get(key="height"),key="rWXquVyXhLOrWzfAePORacyXOsGNYygNNvQiZOuAgeiwXywGQVsWxAaeXMaqtrouGRmOeqiHNXwRpeqUOubcTEWWUdOOQbXVqMrLgirudAVwzpEpLiFHQjFHzfDAhbOU"),set(value=get(key="height"),key="height")}),key="color"),set(value=trunc(expr=la.x(v=get(key="color"))),key="r"),set(value=trunc(expr=la.y(v=get(key="color"))),key="g"),set(value=trunc(expr=la.z(v=get(key="color"))),key="b"),set(value=sequence{get(key="data"),get(key="r")," ",get(key="g")," ",get(key="b"),ascii.endl()},key="data"),increment(id="y")}),increment(id="x")}),get(key="data")}},id="render_all"),callw(expr=_eval(id="render_all"),after=progn{set(value=get(key="YKjluIocNekZfHedHTKgJHpAPQdqHvnKaNnyrtvCdmPHkyRHRXVBUPZulWMxUaUNCcisNTWfcFenbEvfsviwxaAgasuZHDNIhgVbnnAIdODtgfpUtZIpcqTRMKqjajWg"),key="width"),set(value=get(key="oLaIsPPpSUSZZnTLlpVzGybqtnhdScXIHNzAALQDrEKBNnfFnREMLoHpThgvmkNrwGmqowNEqqelDBZsJwGkYmjezLXNxgTgWIDNclxpXjdZzPycNcHXqXXiIeelscBt"),key="height")},before=progn{set(value=get(key="width"),key="YKjluIocNekZfHedHTKgJHpAPQdqHvnKaNnyrtvCdmPHkyRHRXVBUPZulWMxUaUNCcisNTWfcFenbEvfsviwxaAgasuZHDNIhgVbnnAIdODtgfpUtZIpcqTRMKqjajWg"),set(value="100",key="width"),set(value=get(key="height"),key="oLaIsPPpSUSZZnTLlpVzGybqtnhdScXIHNzAALQDrEKBNnfFnREMLoHpThgvmkNrwGmqowNEqqelDBZsJwGkYmjezLXNxgTgWIDNclxpXjdZzPycNcHXqXXiIeelscBt"),set(value="100",key="height")})}
